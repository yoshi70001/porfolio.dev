<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Welcome file</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__html">
    <h1 id="üåê-conexi√≥n-a-netsuite-con-oauth-2.0-gu√≠a-r√°pida-üöÄ">üåê Conexi√≥n a NetSuite con OAuth 2.0: Gu√≠a R√°pida üöÄ
    </h1>
    <p>OAuth 2.0 es el est√°ndar de la industria para la autorizaci√≥n. Permite que aplicaciones de terceros accedan a
      recursos de NetSuite en nombre de un usuario, sin exponer las credenciales del usuario.</p>
    <h2 id="üìú-flujo-general-de-oauth-2.0-authorization-code-grant">üìú Flujo General de OAuth 2.0 (Authorization Code
      Grant)</h2>
    <ol>
      <li><strong>Tu Aplicaci√≥n</strong> ‚û°Ô∏è Redirige al Usuario a <strong>NetSuite</strong> para autorizaci√≥n.</li>
      <li><strong>Usuario</strong> üë§ Inicia sesi√≥n en NetSuite y autoriza tu aplicaci√≥n.</li>
      <li><strong>NetSuite</strong> ‚û°Ô∏è Redirige de vuelta a <strong>Tu Aplicaci√≥n</strong> con un
        <code>c√≥digo de autorizaci√≥n</code>.
      </li>
      <li><strong>Tu Aplicaci√≥n</strong> üîÑ Intercambia el <code>c√≥digo de autorizaci√≥n</code> con
        <strong>NetSuite</strong> por un <code>token de acceso</code> (y un <code>token de refresco</code>).
      </li>
      <li><strong>Tu Aplicaci√≥n</strong> üîë Usa el <code>token de acceso</code> para realizar llamadas API a
        <strong>NetSuite</strong>.
      </li>
    </ol>
    <hr>
    <h2 id="üõ†Ô∏è-paso-1-configuraci√≥n-en-netsuite-lado-del-servidor">üõ†Ô∏è Paso 1: Configuraci√≥n en NetSuite (Lado del
      Servidor)</h2>
    <p>Necesitar√°s permisos de administrador en NetSuite.</p>
    <ol>
      <li>
        <p><strong>Habilitar Caracter√≠sticas:</strong></p>
        <ul>
          <li>Ve a <code>Setup &gt; Company &gt; Enable Features</code>.</li>
          <li>En la pesta√±a <code>SuiteCloud</code>, aseg√∫rate de que las siguientes caracter√≠sticas est√©n habilitadas:
            <ul>
              <li><code>SERVER SUITESCRIPT</code> (si planeas usar SuiteScript)</li>
              <li><code>CLIENT SUITESCRIPT</code> (si planeas usar SuiteScript)</li>
              <li><code>SUITETALK (WEB SERVICES)</code></li>
              <li><code>OAUTH 2.0</code></li>
            </ul>
          </li>
          <li>Guarda los cambios.</li>
        </ul>
      </li>
      <li>
        <p><strong>Crear un Registro de Integraci√≥n:</strong></p>
        <ul>
          <li>Ve a <code>Setup &gt; Integration &gt; Manage Integrations &gt; New</code>.</li>
          <li><strong>Nombre:</strong> Dale un nombre descriptivo a tu integraci√≥n (ej: ‚ÄúMi App OAuth2‚Äù).</li>
          <li><strong>Estado:</strong> <code>Enabled</code>.</li>
          <li><strong>Nota (Opcional):</strong> Descripci√≥n de la integraci√≥n.</li>
          <li>En la pesta√±a <code>Authentication</code>:
            <ul>
              <li>Marca la casilla <code>OAUTH 2.0</code>.</li>
              <li><strong>Grant Type:</strong> Selecciona <code>AUTHORIZATION CODE GRANT</code>.</li>
              <li><strong>REDIRECT URI(s):</strong> Ingresa la(s) URL(s) a la(s) que NetSuite redirigir√° al usuario
                despu√©s de la autorizaci√≥n. Esta debe ser una URL en tu aplicaci√≥n que pueda manejar el c√≥digo de
                autorizaci√≥n. (Ej: <code>https://miapp.com/oauth2/callback</code>)</li>
              <li><strong>OAUTH 2.0 SCOPES:</strong> Selecciona los permisos necesarios para tu aplicaci√≥n (ej:
                <code>REST WEB SERVICES</code>, <code>USER_PROFILE</code>, <code>TRANSACTIONS</code>, etc.).
              </li>
            </ul>
          </li>
          <li>Guarda el registro de integraci√≥n.</li>
        </ul>
      </li>
      <li>
        <p><strong>Obtener Credenciales:</strong></p>
        <ul>
          <li>Una vez guardado, NetSuite mostrar√° el <code>CLIENT ID</code> y <code>CLIENT SECRET</code>.</li>
          <li><strong>¬°IMPORTANTE!</strong> Copia y guarda de forma segura el <code>Client ID</code> y
            <code>Client Secret</code>. El <code>Client Secret</code> no se mostrar√° de nuevo.
          </li>
        </ul>
      </li>
    </ol>
    <hr>
    <h2 id="‚öôÔ∏è-paso-2-flujo-de-autorizaci√≥n-lado-de-tu-aplicaci√≥n-cliente">‚öôÔ∏è Paso 2: Flujo de Autorizaci√≥n (Lado de tu
      Aplicaci√≥n Cliente)</h2>
    <p>Ahora, en tu aplicaci√≥n, implementar√°s el flujo OAuth 2.0.</p>
    <h3 id="solicitud-de-autorizaci√≥n-del-usuario">2.1. Solicitud de Autorizaci√≥n del Usuario</h3>
    <p>Redirige al usuario al endpoint de autorizaci√≥n de NetSuite.<br>
      Construye la URL de la siguiente manera:</p>
    <ul>
      <li>
        <p><strong>URL Base:</strong>
          <code>https://&lt;ACCOUNT_ID&gt;.app.netsuite.com/app/login/oauth2/authorize.nl</code>
        </p>
        <ul>
          <li>Reemplaza <code>&lt;ACCOUNT_ID&gt;</code> con tu ID de cuenta de NetSuite (ej: <code>1234567</code> o
            <code>1234567_SB1</code> para sandbox). Puedes encontrarlo en
            <code>Setup &gt; Company &gt; Company Information &gt; ACCOUNT ID</code>.
          </li>
        </ul>
      </li>
      <li>
        <p><strong>Par√°metros (Query String):</strong></p>
        <ul>
          <li><code>response_type=code</code></li>
          <li><code>client_id=&lt;TU_CLIENT_ID&gt;</code> (El Client ID obtenido en el Paso 1.3)</li>
          <li><code>redirect_uri=&lt;TU_REDIRECT_URI&gt;</code> (La misma URI que configuraste en NetSuite)</li>
          <li><code>scope=&lt;LISTA_DE_SCOPES_SEPARADOS_POR_ESPACIO&gt;</code> (Ej:
            <code>rest_webservices user_profile</code>)
          </li>
          <li><code>state=&lt;VALOR_ALEATORIO_SEGURO&gt;</code> (Opcional pero recomendado para prevenir CSRF)</li>
        </ul>
      </li>
    </ul>
    <p><strong>Ejemplo de URL de Autorizaci√≥n:</strong><br>
      <a
        href="https://www.google.com/url?sa=E&amp;q=https://1234567.app.netsuite.com/app/login/oauth2/authorize.nl?response_type=code&amp;client_id=abcdef12345&amp;redirect_uri=https%3A%2F%2Fmiapp.com%2Foauth2%2Fcallback&amp;scope=rest_webservices%20transactions&amp;state=xyz789">https://1234567.app.netsuite.com/app/login/oauth2/authorize.nl?response_type=code&amp;client_id=abcdef12345&amp;redirect_uri=https%3A%2F%2Fmiapp.com%2Foauth2%2Fcallback&amp;scope=rest_webservices%20transactions&amp;state=xyz789</a>
    </p>
    <h3 id="usuario-autoriza-la-aplicaci√≥n">2.2. Usuario Autoriza la Aplicaci√≥n</h3>
    <p>El usuario ser√° llevado a la p√°gina de login de NetSuite. Despu√©s de iniciar sesi√≥n, se le presentar√° una
      pantalla para autorizar o denegar el acceso a tu aplicaci√≥n con los scopes solicitados.</p>
    <h3 id="netsuite-redirige-con-el-c√≥digo-de-autorizaci√≥n">2.3. NetSuite Redirige con el C√≥digo de Autorizaci√≥n</h3>
    <p>Si el usuario autoriza, NetSuite lo redirigir√° a tu <code>redirect_uri</code> con:</p>
    <ul>
      <li><code>code=&lt;CODIGO_DE_AUTORIZACION&gt;</code></li>
      <li><code>state=&lt;VALOR_STATE_ORIGINAL&gt;</code> (si lo enviaste)</li>
    </ul>
    <p><strong>Ejemplo de Redirecci√≥n:</strong><br>
      <code>https://miapp.com/oauth2/callback?code=def456&amp;state=xyz789</code>
    </p>
    <p>Tu aplicaci√≥n debe capturar este <code>code</code>.</p>
    <h3 id="intercambiar-el-c√≥digo-por-tokens-de-acceso-y-refresco">2.4. Intercambiar el C√≥digo por Tokens de Acceso y
      Refresco</h3>
    <p>Con el <code>code</code> obtenido, tu aplicaci√≥n debe hacer una petici√≥n <code>POST</code> al endpoint de token
      de NetSuite para obtener el <code>access_token</code> y <code>refresh_token</code>.</p>
    <ul>
      <li>
        <p><strong>URL del Token:</strong>
          <code>https://&lt;ACCOUNT_ID&gt;.suitetalk.api.netsuite.com/services/rest/auth/oauth2/v1/token</code>
        </p>
        <ul>
          <li>Reemplaza <code>&lt;ACCOUNT_ID&gt;</code> con tu ID de cuenta.</li>
        </ul>
      </li>
      <li>
        <p><strong>M√©todo:</strong> <code>POST</code></p>
      </li>
      <li>
        <p><strong>Headers:</strong></p>
        <ul>
          <li><code>Content-Type: application/x-www-form-urlencoded</code></li>
          <li><code>Authorization: Basic &lt;BASE64_ENCODED_CLIENT_ID:CLIENT_SECRET&gt;</code>
            <ul>
              <li>Donde <code>&lt;BASE64_ENCODED_CLIENT_ID:CLIENT_SECRET&gt;</code> es la cadena
                <code>CLIENT_ID:CLIENT_SECRET</code> codificada en Base64. (Ej:
                <code>YWJjZGVmMTIzNDU6c2VjcmV0eHl6Nzg5</code>)
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li>
        <p><strong>Cuerpo de la Petici√≥n (form-urlencoded):</strong></p>
        <ul>
          <li><code>grant_type=authorization_code</code></li>
          <li><code>code=&lt;CODIGO_DE_AUTORIZACION_RECIBIDO&gt;</code></li>
          <li><code>redirect_uri=&lt;TU_REDIRECT_URI&gt;</code></li>
        </ul>
      </li>
    </ul>
    <p><strong>Ejemplo de Petici√≥n (usando cURL):</strong></p>
    <pre class=" language-bash"><code class="prism  language-bash">curl -X POST \
  <span class="token string">'https://1234567.suitetalk.api.netsuite.com/services/rest/auth/oauth2/v1/token'</span> \
  -H <span class="token string">'Content-Type: application/x-www-form-urlencoded'</span> \
  -H <span class="token string">'Authorization: Basic YWJjZGVmMTIzNDU6c2VjcmV0eHl6Nzg5'</span> \
  -d <span class="token string">'grant_type=authorization_code&amp;code=def456&amp;redirect_uri=https%3A%2F%2Fmiapp.com%2Foauth2%2Fcallback'</span>```
</code></pre>
    <p><em><strong>Respuesta Exitosa (JSON):</strong></em></p>
    <pre class=" language-bash"><code class="prism  language-bash"><span class="token punctuation">{</span>
  <span class="token string">"access_token"</span><span class="token keyword">:</span> <span class="token string">"an_access_token_string"</span>,
  <span class="token string">"refresh_token"</span><span class="token keyword">:</span> <span class="token string">"a_refresh_token_string"</span>,
  <span class="token string">"expires_in"</span><span class="token keyword">:</span> 3600, // Segundos hasta que el access_token expire <span class="token punctuation">(</span>generalmente 1 hora<span class="token punctuation">)</span>
  <span class="token string">"token_type"</span><span class="token keyword">:</span> <span class="token string">"Bearer"</span>
<span class="token punctuation">}</span>
</code></pre>
    <blockquote>
      <p><strong>¬°IMPORTANTE!</strong> Almacena de forma segura el access_token y el refresh_token. El refresh_token se
        usa para obtener nuevos access_token cuando el actual expire, sin necesidad de que el usuario vuelva a
        autorizar.</p>
    </blockquote>
    <hr>
    <h2 id="üöÄ-paso-3-realizar-peticiones-api-a-netsuite">üöÄ Paso 3: Realizar Peticiones API a NetSuite</h2>
    <p>Usa el access_token obtenido para autorizar tus llamadas a la API REST de NetSuite.</p>
    <ul>
      <li>
        <p><strong>Header de Autorizaci√≥n:</strong> Authorization: Bearer &lt;ACCESS_TOKEN&gt;</p>
      </li>
      <li>
        <p><strong>Header Adicional (para REST):</strong> Prefer: transient (opcional, pero puede ayudar con la
          concurrencia y el versionado)</p>
      </li>
    </ul>
    <p><strong>Ejemplo de Petici√≥n API (usando cURL para obtener un registro de cliente):</strong></p>
    <pre class=" language-bash"><code class="prism  language-bash">curl -X GET \
  <span class="token string">'https://&lt;ACCOUNT_ID&gt;.suitetalk.api.netsuite.com/services/rest/record/v1/customer/123'</span> \
  -H <span class="token string">'Authorization: Bearer an_access_token_string'</span> \
  -H <span class="token string">'Prefer: transient'</span>
</code></pre>
    <p>Reemplaza &lt;ACCOUNT_ID&gt; y el ID del cliente (123).</p>
    <h2 id="üîÑ-paso-4-refrescar-el-token-de-acceso-opcional-pero-recomendado">üîÑ Paso 4: Refrescar el Token de Acceso
      (Opcional pero Recomendado)</h2>
    <p>Cuando el access_token expire, usa el refresh_token para obtener uno nuevo.</p>
    <ul>
      <li>
        <p><strong>URL del Token:</strong>
          https://&lt;ACCOUNT_ID&gt;.suitetalk.api.netsuite.com/services/rest/auth/oauth2/v1/token</p>
      </li>
      <li>
        <p><strong>M√©todo:</strong> POST</p>
      </li>
      <li>
        <p><strong>Headers:</strong></p>
        <ul>
          <li>
            <p>Content-Type: application/x-www-form-urlencoded</p>
          </li>
          <li>
            <p>Authorization: Basic &lt;BASE64_ENCODED_CLIENT_ID:CLIENT_SECRET&gt;</p>
          </li>
        </ul>
      </li>
      <li>
        <p><strong>Cuerpo de la Petici√≥n (form-urlencoded):</strong></p>
        <ul>
          <li>
            <p>grant_type=refresh_token</p>
          </li>
          <li>
            <p>refresh_token=&lt;TU_REFRESH_TOKEN_GUARDADO&gt;</p>
          </li>
        </ul>
      </li>
    </ul>
    <p><strong>Respuesta Exitosa (JSON):</strong></p>
    <pre><code>{
  "access_token": "a_new_access_token_string",
  "expires_in": 3600,
  "token_type": "Bearer"
  // NetSuite puede o no devolver un nuevo refresh_token. Si lo hace, actualiza el que tienes guardado.
}
</code></pre>
    <h2 id="üí°-consideraciones-importantes">üí° Consideraciones Importantes</h2>
    <ul>
      <li>
        <p><strong>Seguridad del Client Secret:</strong> Trata el Client Secret como una contrase√±a. No lo expongas en
          el c√≥digo del lado del cliente (frontend).</p>
      </li>
      <li>
        <p><strong>Almacenamiento de Tokens:</strong> Almacena los access_token y refresh_token de forma segura (ej:
          base de datos encriptada, gestor de secretos).</p>
      </li>
      <li>
        <p><strong>Manejo de Errores:</strong> Implementa un manejo robusto de errores para todos los pasos del flujo
          OAuth y las llamadas API.</p>
      </li>
      <li>
        <p><strong>Par√°metro state:</strong> √ösalo para mitigar ataques CSRF. Genera un valor aleatorio antes de
          redirigir al usuario, gu√°rdalo en la sesi√≥n del usuario, y verifica que el valor devuelto por NetSuite
          coincida.</p>
      </li>
      <li>
        <p><strong>Vigencia de Tokens:</strong> Los access_token suelen tener una vida corta (1 hora). Los refresh_token
          suelen tener una vida m√°s larga (ej: 7 d√≠as, o hasta ser revocados), pero esto puede variar. Consulta la
          documentaci√≥n de NetSuite.</p>
      </li>
      <li>
        <p><strong>Scopes:</strong> Solicita solo los scopes (permisos) que tu aplicaci√≥n realmente necesita.</p>
      </li>
    </ul>
    <hr>
  </div>
</body>

</html>